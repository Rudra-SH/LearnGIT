name: Fetch Personal Repositories

on:
  push:
    branches:
      - main  # Replace with your default branch name

jobs:
  fetch-repos:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Set up Node.js
        uses: actions/setup-node@v2
        with:
          node-version: 14

      - name: Install dependencies
        run: npm install @octokit/rest

      - uses: actions/github-script@v6
        with:
          script: |
            const { Octokit } = require('@octokit/rest');
  
            const octokit = new Octokit({
              auth: process.env.PERSONAL_ACCESS_TOKEN, // Access the PAT stored as a secret
            });
  
            octokit.repos
              .listForAuthenticatedUser({
                visibility: 'private', // You can change this to 'public' if needed
              })
              .then(({ data }) => {
                data.forEach(repo => {
                  console.log(repo.name);
                });
              })
              .catch(error => {
                console.error(error);
                process.exit(1);
              });
